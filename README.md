# Access Control List
A ip based access control solution for [jwilder/nginx-proxy](https://github.com/nginx-proxy/nginx-proxy)

## Setup Instructions
* Build ACL
  ```bash
  $ sudo docker build -t acl .
  ```

* Modify `docker-compose.yml` (e.g. setting secure passwords, replacing `example` with your actual domain name and `com` with your actual top level domain)

* Start all services
  ```
  $ sudo docker-compose up -d
  ```

## Environment Variables

| Key                  | Description                                                                                                                       | Default Value                 |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
| SQL_ENGINE           | Database Driver which should be used                                                                                              | django.db.backends.postgresql |
| SQL_HOST             | Hostname / IP of the database                                                                                                     |                               |
| SQL_PORT             | Database Port                                                                                                                     | 5432                          |
| SQL_USER             | Database User                                                                                                                     | acl                           |
| SQL_PASSWORD         | Database Password                                                                                                                 |                               |
| SQL_DATABASE         | Database Name                                                                                                                     | acl                           |
| ACL_FILE_PATH        | Path to the folder where the include files are                                                                                    |                               |
| SCHEDULE_UPDATE_TIME | time for the schedule to iterate and request an ip for a domain                                                                   | 300 (seconds)                 |
| PROXY_CONTAINER      | NGINX Proxy container for reload (nginx -s reload)                                                                                |                               |
| DEBUG                | Debug Mode                                                                                                                        | 0 / False                     |
| SECRET_KEY           | Secret Key of the Django App                                                                                                      | [autogenerated]               |
| ALLOWED_HOSTS        |                                                                                                                                   | 0.0.0.0                       |
| LDAP_URI             | URI for ldap server - e.g. ldap://ldap:389 - if set ldap auth will be enabled                                                     |                               |
| LDAP_BIND_DN         | LDAP Bind DN - e.g. cn=admin,dc=example,dc=com                                                                                    |                               |
| LDAP_BIND_PASS       | LDAP Bind Password                                                                                                                |                               |
| LDAP_USERS           | LDAP Users / People OU - e.g. ou=people,dc=example,dc=com                                                                         |                               |
| LDAP_GROUPS          | LDAP Groups OU - e.g. ou=people,dc=example,dc=com                                                                                 |                               |
| LDAP_GROUP           | DN of LDAP Group, which users need to be member of to use the acl - e.g. cn=acl,ou=groups,dc=example,dc=com                       |                               |
| LDAP_SUPERGROUP      | DN of LDAP Group, which users need to be member of to administrate the acl - e.g. cn=superuser,cn=acl,ou=groups,dc=example,dc=com |                               |


## TODO's
* (Nico) [multi stage build](https://pythonspeed.com/articles/multi-stage-docker-python/)
* (Paul) Improve LDAP search query to also enable login using common name / mail
  ```bash
  # hint
  (&(|(uid=%u))(|(mail=%u))(|(cn=%u)))
  # might work ... (something like this...)
  ```
